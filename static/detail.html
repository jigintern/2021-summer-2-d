<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>詳細</title>
        <link rel="stylesheet" href="./css/detail.css">
        <script type="text/javascript" src="script/fetchJSON.js"></script>
        <script type="text/javascript" src="script/board.js"></script>
        
        <script type=module>
            const enc = (s) => {
                s = s.replace(/&/g, "&amp;");
                s = s.replace(/</g, "&lt;");
                s = s.replace(/>/g, "&gt;");
                s = s.replace(/\n/g, "<br>");
                s = s.replace(/"/g, "&quot");
                s = s.replace(/'/g, "&#39");
                return s;
            };
    
            window.onload = async () => {
                console.log("reload");
                console.log(ID);
                const api_url="api/list?"+ID.toString();
                console.log(api_url);
                const data=await fetchJSON(api_url);
                for (const d of data) {
                    const div = document.createElement("div");
                    div.className = "bbsitem";
                    div.innerHTML = `<span class=date>${enc(d.date)}</span> by <span class=name>${enc(d.name)}</span><div class=body>${enc(d.body)}</div>`
                    board.appendChild(div);
                }
            };
        </script>
    </head>
    <body>
        <div id=container></div>    
        
        <h1>掲示板</h1>
        <div id=board></div>
            
            <div class=writebox>
                名前：<input type=text id=inp_name><br>コメント<br>
                <textarea id=inp_body></textarea><br>
                <button onclick="add_board(0)">書き込む</button>
        </div>
        <div id="map"></div>

    </body>
    <script type="module">
        import{fetchJSON}from "https://js.sabae.cc/fetchJSON.js";
        import { enc } from "https://js.sabae.cc/enc.js";      
        
        let la;
        let ln;

        window.onload=async()=>{
            console.log("reload");
            let Params = new URLSearchParams(window.location.search);
            
            let which = Params.get('type');
            let ID=Params.get('ID');

            if(ID==null) ID=1;

            console.log(ID);
            const api_url="api/list?"+ID.toString();
            console.log(api_url);
            const data=await fetchJSON(api_url);
            for (const d of data) {
                const div = document.createElement("div");
                div.className = "bbsitem";
                div.innerHTML = `<span class=date>${enc(d.date)}</span> by <span class=name>${enc(d.name)}</span><div class=body>${enc(d.body)}</div>`
                board.appendChild(div);
            }
            
            const load=async()=>{

                let item={"type":which,"ID":ID};
                if (which == "beach"){
                    console.log("beach selected");
                }else if (which == "rever"){
                    console.log("rever selected");
                }
            
                const d=await fetchJSON("/api/get",item);
                container.innerHTML="";
                console.log(d)
                const div=document.createElement("div");
                div.className="beaches";
                div.innerHTML=`<span class=ID>${(d.ID)}</span> by <span class=name>${(d.name)}</span>
                    <img src=${(d.img)} width="30%"> <p>${(d.info)}</p> `

                container.appendChild(div);
                
                //以下地図
                const script = document.createElement('script');
                script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyAcMRVInnrt2J0VysiO3gUOD7ksQv89pX4&callback=initMap';
                script.async = true;
                
                //Attach your callback function to the `window` object
                window.initMap = function () {
                // JS API is loaded and available
                    console.log("map");
                    mapobj = new google.maps.Map(document.getElementById('map'), {
                        center: { lat: d.lat, lng: d.lng },
                        zoom: 15
                    });
                };
                
                document.head.append(script)
                }
            
            
            load();
        }
    </script>
    
    
</html>