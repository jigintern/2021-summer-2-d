<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>詳細</title>
        <link rel="stylesheet" href="./css/detail.css">
        <script type="text/javascript" src="script/fetchJSON.js"></script>
        <script type="text/javascript" src="script/board.js"></script>
        <script type="text/javascript" src="script/table.js"></script>
        <style>
            dialog{
                z-index: +100;
                width:50%;
                height:75%;
            }
        </style>
    </head>
    <body>
        <main>
            <dialog><div id="dialog_area"></div></dialog>
            <div id=container></div>
            
            <div id=table></div>


            <div class="content">
                <div class="map">
                    <h4 class="map-header">場所</h4>
                <div id="map">
                </div>
                </div>

                <div class="board">
                    <h2>掲示板</h2>
                    <div class=writebox>
                        名前：<input type=text id=inp_name><br>コメント<br>
                        <textarea id=inp_body></textarea><br>
                        <button id="write">書き込む</button>
                    </div>
                    <div id=board></div>
                </div>

            </div>
        </main>
    </body>
    <script type="module">
        import{fetchJSON}from "https://js.sabae.cc/fetchJSON.js";
        import { enc } from "https://js.sabae.cc/enc.js";      
        
        
        let la;
        let ln;

        let Params = new URLSearchParams(window.location.search);
            
        let which = Params.get('type');
        let ID=Params.get('ID');
        if(ID==null) ID=1;
        const item={"type":which,"ID":ID};

        window.onload=async()=>{
            console.log("reload");
            show_dialog(); 
            const load=async()=>{

                
                if (which == "beach"){
                    console.log("beach selected");
                }else if (which == "rever"){
                    console.log("rever selected");
                }
            
                const d=await fetchJSON("/api/get",item);
                container.innerHTML="";
                console.log(d)
                const div=document.createElement("div");
                div.className="beaches";
                div.innerHTML=`<h1 class=name>${(d.name)}</h1>
                <img src=${(d.img)}><div class="text"><p>${(d.info)}</p></div> `

                container.appendChild(div);
                
                //以下地図
                const script = document.createElement('script');
                script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyAcMRVInnrt2J0VysiO3gUOD7ksQv89pX4&callback=initMap';
                script.async = true;
                
                //Attach your callback function to the `window` object
                window.initMap = function () {
                // JS API is loaded and available
                    console.log("map");
                    mapobj = new google.maps.Map(document.getElementById('map'), {
                        center: { lat: d.lat, lng: d.lng },
                        zoom: 15
                    });
                };
                
                document.head.append(script)
                }
            
            load_board(item);
            if(which=="river"){
                const d=await fetchJSON("api/get",item);
                const table_item={"name":d.river,"watch":d.watch};
                //criate_table(table_item.name);
                water_level(table_item);
            }
            load();         
            dialog.show();
        }

        write.onclick=async()=>{
            add_board(item);
        }
    </script>
    
    <script type="text/javascript" src="script/dialog.js"></script>
    
</html>